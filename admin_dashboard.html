<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Share A Ride</title>
    <!-- Link to your existing main CSS for general styling -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Link to the new admin specific CSS -->
    <link rel="stylesheet" href="css/admin_style.css">
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Global Notification Message Box (reused from index.html) -->
    <div id="notificationMessageBox" class="global-message-box"></div>

    <!-- Custom Confirmation Modal (for Approve/Reject/Suspend/Activate) -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal-id="confirmationModal">&times;</span>
            <div class="modal-header-fixed">
                <h2>Confirm Action</h2>
            </div>
            <div class="modal-body-scrollable">
                <p id="confirmationMessage"></p>
                <div class="button-group">
                    <button id="confirmActionButton" class="confirm-button">Confirm</button>
                    <button id="cancelActionButton" class="cancel-button">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Detail View Modal -->
    <div id="userDetailModal" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal-id="userDetailModal">&times;</span>
            <div class="modal-header-fixed">
                <h2>User Details</h2>
            </div>
            <div class="modal-body-scrollable user-details-grid">
                <p><strong>UID:</strong> <span id="detailUid"></span></p>
                <p><strong>Email:</strong> <a id="detailEmail" href="#" target="_blank"></a></p>
                <p><strong>First Name:</strong> <span id="detailFirstName"></span></p>
                <p><strong>Last Name:</strong> <span id="detailLastName"></span></p>
                <p><strong>Mobile:</strong> <a id="detailMobile" href="#"></a></p>
                <p><strong>Gender:</strong> <span id="detailGender"></span></p>
                <p><strong>Facebook:</strong> <a id="detailFacebook" href="#" target="_blank"></a></p>
                <p><strong>Role:</strong> <span id="detailRole"></span></p>
                <p><strong>City:</strong> <span id="detailCity"></span></p>
                <p><strong>Account Status:</strong> <span id="detailAccountStatus"></span></p>
                <p><strong>Registered On:</strong> <span id="detailCreatedAt"></span></p>
                <p><strong>Last Updated:</strong> <span id="detailUpdatedAt"></span></p>

                <div class="user-detail-actions">
                    <button id="suspendUserButton" class="suspend-button">Suspend Account</button>
                    <button id="activateUserButton" class="approve-button">Activate Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ride Booked Riders List Modal -->
    <div id="rideBookedRidersModal" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal-id="rideBookedRidersModal">&times;</span>
            <div class="modal-header-fixed">
                <h2>Riders for Ride ID: <span id="bookedRidersRideId"></span></h2>
            </div>
            <div class="modal-body-scrollable">
                <p id="bookedRidersCountInfo">Total Booked: 0</p>
                <table id="bookedRidersTable">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Name</th>
                            <th>Mobile</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Booked rider data will be loaded here by JavaScript -->
                    </tbody>
                </table>
                <p id="noBookedRidersMessage" style="text-align: center; font-style: italic; color: #777; margin-top: 15px; display: none;">No riders have booked this ride yet.</p>
            </div>
        </div>
    </div>

    <!-- Passenger Ride History Modal -->
    <div id="passengerRidesModal" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal-id="passengerRidesModal">&times;</span>
            <div class="modal-header-fixed">
                <h2>Ride History for: <span id="passengerHistoryEmail"></span></h2>
            </div>
            <div class="modal-body-scrollable">
                <table id="passengerRidesTable">
                    <thead>
                        <tr>
                            <th>Ride ID</th>
                            <th>Driver Email</th>
                            <th>Start Location</th>
                            <th>End Location</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Status</th>
                            <th>Created On</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Passenger's ride data will be loaded here by JavaScript -->
                    </tbody>
                </table>
                <p id="noPassengerRidesMessage" style="text-align: center; font-style: italic; color: #777; margin-top: 15px; display: none;">No rides found for this passenger.</p>
            </div>
        </div>
    </div>

    <header class="admin-header">
        <h1>Admin Dashboard</h1>
        <nav>
            <!-- Role Selection Dropdown -->
            <div class="role-selector-container">
                <select id="roleSelector" class="role-selector">
                    <option value="">Switch Role</option>
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <button id="adminLogoutButton">Log Out</button>
        </nav>
    </header>

    <main class="admin-main">
        <div class="tab-controls">
            <button class="tab-button active" data-tab="userManagement">User Account Management</button>
            <button class="tab-button" data-tab="ridesOverview">Rides Overview & Management</button>
            <button class="tab-button" data-tab="analyticsDashboard">Analytics & Statistics</button>
            <button class="tab-button" data-tab="notificationsConfig">Notifications & Alerts</button>
        </div>

        <!-- User Account Management Section -->
        <div id="userManagement" class="tab-pane active">
            <section class="admin-section">
                <h2>User Account Management</h2>
                <p>Review and approve user accounts. Only users with 'Awaiting Email Verification' or 'Awaiting Admin Approval' are shown by default.</p>
                <p class="admin-note">Note: Admin roles are assigned manually by the developer using the Firebase CLI or Admin SDK for security and cost control.</p>

                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="statusFilter">Show Status:</label>
                        <select id="statusFilter">
                            <option value="Awaiting Admin Approval">Awaiting Admin Approval</option>
                            <option value="Awaiting Email Verification">Awaiting Email Verification</option>
                            <option value="Access Granted">Access Granted</option>
                            <option value="Rejected">Rejected</option>
                            <option value="Suspended">Suspended</option>
                            <option value="All">All Users</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="roleFilter">Filter by Role:</label>
                        <select id="roleFilter">
                            <option value="All">All Roles</option>
                            <option value="driver">Driver</option>
                            <option value="passenger">Passenger</option>
                            <option value="hybrid">Hybrid</option>
                        </select>
                    </div>

                    <div class="filter-group search-group">
                        <label for="userSearch">Search:</label>
                        <input type="text" id="userSearch" placeholder="Email, Name, Mobile...">
                    </div>

                    <button id="refreshUsersButton">Refresh Users</button>
                    <button id="exportCsvButton">Export Users CSV</button>
                </div>

                <div class="users-table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th data-sort-key="email">Email</th>
                                <th data-sort-key="firstName">First Name</th>
                                <th data-sort-key="lastName">Last Name</th>
                                <th data-sort-key="mobile">Mobile</th> 
                                <th data-sort-key="gender">Gender</th> 
                                <th data-sort-key="role">Role</th>
                                <th data-sort-key="accountStatus">Status</th>
                                <th data-sort-key="createdAt">Registered On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- User data will be loaded here by JavaScript -->
                            <tr><td colspan="9">Loading users...</td></tr> 
                        </tbody>
                    </table>
                </div>

                <div class="pagination-controls">
                    <button id="prevPageButton" disabled>&laquo; Prev</button>
                    <span id="pageInfo">Page 1 of 1</span>
                    <button id="nextPageButton" disabled>Next &raquo;</button>
                    <div class="items-per-page">
                        Items per page:
                        <select id="itemsPerPageSelect">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
            </section>
        </div>

        <!-- Rides Overview & Management Section -->
        <div id="ridesOverview" class="tab-pane">
            <section class="admin-section">
                <h2>Rides Overview & Management</h2>
                <p>Monitor offered, booked, completed, and cancelled rides.</p>

                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="rideStatusFilter">Show Ride Status:</label>
                        <select id="rideStatusFilter">
                            <option value="All">All Statuses</option>
                            <option value="Offered">Offered</option>
                            <option value="Booked">Booked</option>
                            <option value="Completed">Completed</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="filter-group search-group">
                        <label for="rideSearch">Search Rides:</label>
                        <input type="text" id="rideSearch" placeholder="Driver/Passenger Email, Location...">
                    </div>
                    <button id="refreshRidesButton">Refresh Rides</button>
                    <button id="exportRidesCsvButton">Export Rides CSV</button>
                </div>

                <div class="rides-table-container users-table-container"> <!-- Reusing some styles -->
                    <table id="ridesTable">
                        <thead>
                            <tr>
                                <th data-sort-key="rideId">Ride ID</th>
                                <th data-sort-key="driverEmail">Driver Email</th>
                                <th data-sort-key="passengerEmails">Passenger(s) Email</th>
                                <th data-sort-key="numBookedRiders">Booked Riders</th> 
                                <th data-sort-key="startLocation">Start Location</th>
                                <th data-sort-key="endLocation">End Location</th>
                                <th data-sort-key="rideDate">Date</th>
                                <th data-sort-key="rideTime">Time</th>
                                <th data-sort-key="availableSeats">Seats</th>
                                <th data-sort-key="status">Status</th>
                                <th data-sort-key="createdAt">Created On</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Ride data will be loaded here by JavaScript -->
                            <tr><td colspan="12">No ride data available.</td></tr> 
                        </tbody>
                    </table>
                </div>

                <div class="pagination-controls">
                    <button id="prevRidePageButton" disabled>&laquo; Prev</button>
                    <span id="ridePageInfo">Page 1 of 1</span>
                    <button id="nextRidePageButton" disabled>Next &raquo;</button>
                    <div class="items-per-page">
                        Rides per page:
                        <select id="ridesPerPageSelect">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
            </section>
        </div>

        <!-- NEW: Analytics & Statistics Dashboard Section -->
        <div id="analyticsDashboard" class="tab-pane">
            <section class="admin-section">
                <h2>Analytics & Statistics Dashboard</h2>
                <p>Visualize platform usage trends and key metrics.</p>

                <div class="filter-controls analytics-controls">
                    <div class="filter-group">
                        <label for="analyticsStartDate">From:</label>
                        <input type="date" id="analyticsStartDate">
                    </div>
                    <div class="filter-group">
                        <label for="analyticsEndDate">To:</label>
                        <input type="date" id="analyticsEndDate">
                    </div>
                    <button id="applyAnalyticsFilterButton">Apply Filter</button>
                </div>

                <div class="analytics-charts-container">
                    <div class="chart-card">
                        <h3>New User Sign-ups</h3>
                        <canvas id="userSignupsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Rides Status Distribution</h3>
                        <canvas id="ridesStatusChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Rides Offered vs. Completed</h3>
                        <canvas id="ridesOfferedCompletedChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Top 5 Most Popular Routes</h3>
                        <canvas id="popularRoutesChart"></canvas>
                    </div>
                </div>
            </section>
        </div>

        <!-- NEW: Notifications & Alerts Configuration Section -->
        <div id="notificationsConfig" class="tab-pane">
            <section class="admin-section">
                <h2>Notifications & Alerts Configuration</h2>
                <p>Manage in-app notification templates and send custom announcements.</p>

                <div class="notification-config-container">
                    <h3>Create New In-App Announcement</h3>
                    <div class="form-group">
                        <label for="notificationAudience">Audience:</label>
                        <select id="notificationAudience">
                            <option value="all">All Users</option>
                            <option value="drivers">All Drivers</option>
                            <option value="passengers">All Passengers</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="notificationTitle">Title:</label>
                        <input type="text" id="notificationTitle" placeholder="e.g., Important Update!">
                    </div>
                    <div class="form-group">
                        <label for="notificationMessage">Message:</label>
                        <textarea id="notificationMessage" rows="5" placeholder="Enter your announcement message here..."></textarea>
                    </div>
                    <button id="sendAnnouncementButton">Send Announcement (In-App)</button>
                </div>

                <div class="notification-log-container">
                    <h3>Recent Announcements</h3>
                    <table id="announcementLogTable">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Audience</th>
                                <th>Title</th>
                                <th>Message</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Recent announcements will be loaded here by JavaScript -->
                            <tr><td colspan="4">No recent announcements.</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

    </main>

    <!-- Import Firebase and Auth module -->
    <script type="module" src="js/auth.js"></script>
    <!-- Import the shared dashboard roles script (to handle role selector and logout) -->
    <script type="module" src="js/dashboard_roles.js"></script>
    <!-- Import the admin specific script -->
    <script type="module" src="js/admin_script.js"></script>
</body>
</html>
